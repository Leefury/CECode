SELECT 'POST-UPDATE' FROM DUMMY 
FORMAT '../ZCLA_HOUSETYPE-POST-UPDATE.txt' ;
:DOC = :CUST = :HOUSETYPE = :HOUSETYPEID = :COPIEDFROMTYPE = 0 ;
:ZCLA_COPY = :TYPE = '' ;
SELECT :$.HOUSETYPEID 
,   :$.COPIEDFROMTYPE 
,   :$.HOUSETYPEID 
,   :$.ZCLA_COPY
,   :$$.TYPE
,   :$$.DOC
,   :$$.CUST
INTO :HOUSETYPEID 
,   :COPIEDFROMTYPE 
,   :HOUSETYPE 
,   :ZCLA_COPY
,   :TYPE
,   :DOC 
,   :CUST 
FROM DUMMY ;
SELECT :HOUSETYPEID , :COPIEDFROMTYPE , :ZCLA_COPY
,   :TYPE
,   :DOC 
,   :CUST 
FROM DUMMY FORMAT '../ZCLA_HOUSETYPE-POST-UPDATE.txt'
;
/* Skip if not interface
*/
SELECT :FORM_INTERFACE FROM DUMMY 
FORMAT '../ZCLA_HOUSETYPE-POST-UPDATE.txt' ;
GOTO 999 WHERE :FORM_INTERFACE <> 1
;
/* Skip if not ZCLA_COPY  = 'Y'
*/
SELECT 'N' AS COPY FROM DUMMY
WHERE NOT EXISTS(
SELECT 'x'
FROM ZCLA_HOUSETYPE
WHERE 0=0
AND HOUSETYPEID = :HOUSETYPE
AND ZCLA_COPY  = 'Y'
)
FORMAT ADDTO '../ZCLA_HOUSETYPE-POST-UPDATE.txt' ;
GOTO 999 WHERE NOT EXISTS(
SELECT 'x'
FROM ZCLA_HOUSETYPE
WHERE 0=0
AND HOUSETYPEID = :HOUSETYPE
AND ZCLA_COPY  = 'Y'
);
/* Generate Missing Fixes 
*/
INSERT INTO ZCLA_HOUSETYPEFIX
(HOUSETYPEID , FIXID)
SELECT :HOUSETYPE , FIXID
FROM ZCLA_FIXES
WHERE 0=0
AND   FIX <> '-1'
AND   FIXID > 0
;
SELECT 'delete existing housetype', SQL.USER
FROM DUMMY
FORMAT ADDTO '../ZCLA_HOUSETYPE-POST-UPDATE.txt' ;
/* DELETE the house type properties
*/
DELETE FROM ZCLA_HTCHARS
WHERE HOUSETYPEID = :HOUSETYPE
;
/* DELETE components
*/
DELETE FROM ZCLA_COMPONENT
WHERE COMPONENT IN (
SELECT        ZCLA_COMPONENT.COMPONENT
FROM            ZCLA_HOUSETYPE , ZCLA_ROOMS
WHERE 0=0
AND   ZCLA_HOUSETYPE.HOUSETYPEID = ZCLA_ROOMS.HOUSETYPEID
AND   ZCLA_ROOMS.ROOM = ZCLA_COMPONENT.ROOM
AND   ZCLA_HOUSETYPE.HOUSETYPEID = :HOUSETYPE
);
/* Delete rooms
*/
DELETE FROM ZCLA_ROOMS
WHERE ROOM IN (
SELECT        ZCLA_ROOMS.ROOM
FROM            ZCLA_HOUSETYPE , ZCLA_ROOMS
WHERE 0=0
AND   ZCLA_HOUSETYPE.HOUSETYPEID = ZCLA_ROOMS.HOUSETYPEID
AND   ZCLA_HOUSETYPE.HOUSETYPEID = :HOUSETYPE
);
/* Delete Consumer unit ways
*/
DELETE FROM ZCLA_CUNITCONFIG WHERE CUNITCONFIG IN (
SELECT        ZCLA_CUNITCONFIG.CUNITCONFIG
FROM            ZCLA_CUNITCONFIG, ZCLA_HOUSETYPE ,
ZCLA_CONSUMERUNITS
WHERE 0=0
AND   ZCLA_HOUSETYPE.HOUSETYPEID = ZCLA_CONSUMERUNITS.HOUSETYPEID
AND   ZCLA_CUNITCONFIG.CONSUMERUNIT =
ZCLA_CONSUMERUNITS.CONSUMERUNIT
AND   ZCLA_HOUSETYPE.HOUSETYPEID = :HOUSETYPE
);
/* Delete Consumer unit
*/
DELETE FROM ZCLA_CONSUMERUNITS WHERE CONSUMERUNIT IN (
SELECT ZCLA_CONSUMERUNITS.CONSUMERUNIT
FROM            ZCLA_HOUSETYPE , ZCLA_CONSUMERUNITS
WHERE 0=0
AND   ZCLA_HOUSETYPE.HOUSETYPEID = ZCLA_CONSUMERUNITS.HOUSETYPEID
AND   ZCLA_HOUSETYPE.HOUSETYPEID = :HOUSETYPE
);
/* Delete attachments */
DELETE FROM EXTFILES WHERE EXTFILENUM IN (
SELECT EXTFILES.EXTFILENUM
FROM   EXTFILES , ZCLA_HOUSETYPE
WHERE  0=0
AND    ZCLA_HOUSETYPE.HOUSETYPEID = EXTFILES.IV
AND    ZCLA_HOUSETYPE.HOUSETYPEID = :HOUSETYPE
AND    TYPE = 'Â¬'
);
#INCLUDE ZCLA_HOUSETYPE/POST-INSERT
LABEL 999 ;
/* Update Modifiers */
SELECT 'Update modifiers' FROM DUMMY
FORMAT ADDTO '../ZCLA_HOUSETYPE-POST-UPDATE.txt' ;
#INCLUDE ZCLA_HOUSETYPE/ZCLA_BUF2