CREATE TABLE ZCLA_FIXSTATUSES 'Statuses for Fixes' 0
STEPSTATUS (INT,13,'Activity Status(ID)')
STEPSTATUSDES (CHAR,12,'Activity Status')
INITFLAG (CHAR,1,'Initial Status')
CLOSEFLAG (CHAR,1,'Completed Activity?')
SORT (INT,3,'Display Order')
OPENSERIAL (CHAR,1,'Can Open Work Order?')
INACTIVE (CHAR,1,'Inactive Status')
CANCELFLAG (CHAR,1,'Canceled')
CANCELSTAT (CHAR,1,'Cancellation Status')
CLOSESTATUS (INT,13,'Closing Status')
AUTOUNIQUE (STEPSTATUS)
UNIQUE (STEPSTATUSDES)
NONUNIQUE (CLOSEFLAG)
;
CREATE TABLE ZCLA_ELSTATUSES 'Statuses for Elements' 0
STEPSTATUS (INT,13,'Activity Status(ID)')
STEPSTATUSDES (CHAR,12,'Activity Status')
INITFLAG (CHAR,1,'Initial Status')
CLOSEFLAG (CHAR,1,'Completed Activity?')
SORT (INT,3,'Display Order')
OPENSERIAL (CHAR,1,'Can Open Work Order?')
INACTIVE (CHAR,1,'Inactive Status')
CANCELFLAG (CHAR,1,'Canceled')
CANCELSTAT (CHAR,1,'Cancellation Status')
CLOSESTATUS (INT,13,'Closing Status')
EDITFLAG (CHAR,1,'Editable?')
AUTOUNIQUE (STEPSTATUS)
UNIQUE (STEPSTATUSDES)
NONUNIQUE (CLOSEFLAG)
;
CREATE TABLE ZCLA_FIXACTSTAT 'Fix Statuses' 0
FIXACT (INT,13,'Fix Act (ID)')
PROJACT (INT,13,'Activity (ID)')
OWNER (INT,13,'Owner (ID)')
STEPSTATUS (INT,13,'Fix Status (ID)')
AUTOUNIQUE (FIXACT)
UNIQUE (PROJACT)
;
CREATE TABLE ZCLA_ELACTSTAT 'Element Statuses' 0
ELACT (INT,13,'Element Act (ID)')
PROJACT (INT,13,'Activity (ID)')
OWNER (INT,13,'Owner (ID)')
STEPSTATUS (INT,13,'Element Status (ID)')
AUTOUNIQUE (ELACT)
UNIQUE (PROJACT)
;
CREATE TABLE ZCLA_NEXTFIXSTAT 'Next Fix Status' 0
FIXACT (INT,13,'Ln')
STATDES (CHAR,25,'Loaded?')
SORT (INT,13,'Sort')
UNIQUE (FIXACT,STATDES)
;
CREATE TABLE ZCLA_NEXTELSTAT 'Next Element Status' 0
ELACT (INT,13,'Ln')
STATDES (CHAR,25,'Loaded?')
SORT (INT,13,'Sort')
UNIQUE (ELACT,STATDES)
;


FORMS:
ZCLA_ELSTATUSES
ZCLA_ELACTSTAT
ZCLA_FIXSTATUSES
ZCLA_FIXACTSTAT


PROCEDURE:
ZCLA_VISFIXSTATS
ZCLA_VISELSTATS

INTERFACES:
ZCLA_CHFIXSTAT
ZCLA_CHELSTAT
BPMZCLA_FIX
BPMZCLA_EL
STATUSMAILZCLA_FIX
STATUSMAILZCLA_EL


ZCLA_FIXACT/ZCLA_BUF2
/* Create / Update fix status.
*/
#INCLUDE func/ZCLA_DEBUGUSR
SELECT 'ZCLA_FIXACT/ZCLA_BUF2'
FROM DUMMY
WHERE :DEBUG = 1
FORMAT ADDTO :DEBUGFILE;
:LN = 0 ;
SELECT MAX(LINE) + 1 INTO :LN FROM GENERALLOAD;
/*
*/
GOTO 10 WHERE EXISTS (
SELECT PROJACT
FROM ZCLA_FIXACTSTAT
WHERE 0=0
AND   PROJACT = :$.PROJACT
);
INSERT INTO GENERALLOAD (LINE , RECORDTYPE, INT1 , INT2 , TEXT1 )
SELECT :LN , '1' , :$.PROJACT , :$.USER1 , :$.STEPSTATUSDES
FROM DUMMY ;
GOTO 20 ;
/*
*/
LABEL 10 ;
:KEY1 = '' ;
SELECT ITOA(FIXACT) INTO :KEY1
FROM ZCLA_FIXACTSTAT
WHERE PROJACT = :$.PROJACT ;
INSERT INTO GENERALLOAD (LINE , RECORDTYPE, KEY1 , INT2, TEXT1 )
SELECT :LN , '1' , :KEY1 ,  :$.USER1 , :$.STEPSTATUSDES
FROM DUMMY ;
/*
*/
LABEL 20 ;
#INCLUDE func/ZCLA_RESETERR
EXECUTE INTERFACE 'ZCLA_CHFIXSTAT', SQL.TMPFILE, '-L', :GEN ;
:i_LOGGEDBY = 'ZCLA_CHFIXSTAT' ;
#INCLUDE func/ZEMG_ERRMSGLOG
SELECT LINE, RECORDTYPE , LOADED , KEY1 , INT1 , INT2 , TEXT1
FROM GENERALLOAD
WHERE :DEBUG = 1
FORMAT ADDTO :DEBUGFILE ;
#INCLUDE func/ZCLA_ERRMSG
UNLINK AND REMOVE GENERALLOAD ;

ZCLA_ELACT/ZCLA_BUF8
/* Create / Update fix status.
*/
#INCLUDE func/ZCLA_DEBUGUSR
SELECT 'ZCLA_ELACT/ZCLA_BUF8'
FROM DUMMY
WHERE :DEBUG = 1
FORMAT ADDTO :DEBUGFILE;
:LN = 0 ;
SELECT MAX(LINE) + 1 INTO :LN FROM GENERALLOAD;
/*
*/
GOTO 10 WHERE EXISTS (
SELECT PROJACT
FROM ZCLA_ELACTSTAT
WHERE 0=0
AND   PROJACT = :$.PROJACT
);
INSERT INTO GENERALLOAD (LINE , RECORDTYPE, INT1 , INT2 , TEXT1 )
SELECT :LN , '1' , :$.PROJACT , :$.USER1 , :$.STEPSTATUSDES
FROM DUMMY ;
GOTO 20 ;
/*
*/
LABEL 10 ;
:KEY1 = '' ;
SELECT ITOA(ELACT) INTO :KEY1
FROM ZCLA_ELACTSTAT
WHERE PROJACT = :$.PROJACT ;
INSERT INTO GENERALLOAD (LINE , RECORDTYPE, KEY1 , INT2, TEXT1 )
SELECT :LN , '1' , :KEY1 ,  :$.USER1 , :$.STEPSTATUSDES
FROM DUMMY ;
/*
*/
LABEL 20 ;
#INCLUDE func/ZCLA_RESETERR
EXECUTE INTERFACE 'ZCLA_CHELSTAT', SQL.TMPFILE, '-L', :GEN ;
:i_LOGGEDBY = 'ZCLA_CHELSTAT' ;
#INCLUDE func/ZEMG_ERRMSGLOG
SELECT LINE, RECORDTYPE , LOADED , KEY1 , INT1 , INT2 , TEXT1
FROM GENERALLOAD
WHERE :DEBUG = 1
FORMAT ADDTO :DEBUGFILE ;
#INCLUDE func/ZCLA_ERRMSG
UNLINK AND REMOVE GENERALLOAD ;