/* */
#INCLUDE func/ZCLA_DEBUGUSR
SELECT 'ZCLA_COMPCALC/STEP10' FROM DUMMY
WHERE :DEBUG = 1
FORMAT ADDTO :DEBUGFILE ;
/* */
LINK ZCLA_HOUSETYPE TO :$.PAR;
GOTO 999 WHERE :RETVAL <= 0;
SELECT * FROM ZCLA_HOUSETYPE
WHERE :DEBUG = 1
FORMAT ADDTO :DEBUGFILE;
:HID = 0;
SELECT HOUSETYPEID INTO :HID FROM ZCLA_HOUSETYPE
WHERE HOUSETYPEID > 0;
SELECT :HID FROM DUMMY
WHERE DEBUG = 1
FORMAT ADDTO :DEBUGFILE;
LINK ZCLA_CPRPREFIX TO :CLA;
GOTO 999 WHERE :RETVAL <= 0;
/* Get components per room in a housetype
put it into ZCLA_CPRPERFIX TABLE */
INSERT INTO ZCLA_CPRPREFIX (HOUSETYPEID, TYPENAME, DOC, DOCNO,
PROJDES, ROOMDES, QUANT, PARTNAME, PARTDES, FAMILYNAME, COLNAME)
SELECT H.HOUSETYPEID, H.TYPENAME, H.DOC, D.DOCNO,DP.PROJDES,
R.ROOMDES, C.TQUANT AS QUANT, P.PARTNAME, P.PARTDES, F.FAMILYNAME,
A.NAME AS COL
FROM ZCLA_HOUSETYPE H, DOCUMENTS D, ZCLA_ROOMS R, ZCLA_COMPONENT C,
PART P, FAMILY F, PROJACTS PRO, ZCLA_ACCYCOL A, DOCPROJ DP
WHERE H.DOC = D.DOC AND H.HOUSETYPEID = R.HOUSETYPEID AND
R.ROOM = C.ROOM AND C.PART = P.PART AND P.FAMILY = F.FAMILY
AND H.HOUSETYPEID = :HID
AND PRO.DOC = D.DOC AND C.COL = A.COL
AND PRO.LEVEL = 1
AND D.DOC = DP.DOC
GROUP BY  H.HOUSETYPEID, H.TYPENAME, H.DOC, D.DOCNO,DP.PROJDES,
R.ROOMDES, QUANT, P.PARTNAME, P.PARTDES, F.FAMILYNAME, A.NAME;
/* Get from ZCLA_CPRPERFIX TABLE & put it into  ZCLA_CPRPERFIX.TXT*/
SELECT * FROM ZCLA_CPRPREFIX
FORMAT '../../ZCLA_CPRPERFIX.TXT';
LABEL 999;
UNLINK ZCLA_HOUSETYPE;
UNLINK ZCLA_CPRPREFIX;
